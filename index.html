<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Giants GPT</title>

<link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/en/3/30/San_Francisco_Giants_Logo.svg">
<link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/en/3/30/San_Francisco_Giants_Logo.svg">

<style>
body { margin:0; font-family: Arial, sans-serif; background-color:#F5F5F5; color:#333; transition: background 0.3s, color 0.3s;}
.dark { background-color:#000; color:#FFF;}
header { padding:10px; background:#FD5A1E; color:#fff; text-align:center;}
#container { display:flex; height:100vh; }
#sidebar { width:250px; border-right:1px solid #ccc; overflow-y:auto; background:#f9f9f9; transition: all 0.3s;}
#sidebar.dark { background:#111;}
#sidebar h3 { margin:10px; font-size:16px; }
#sidebar button { margin:5px; padding:5px 8px; border:none; border-radius:4px; background:#FD5A1E; color:#fff; cursor:pointer;}
#sidebar button:hover { background:#e04f1a; }
#historyList { list-style:none; padding:0 10px;}
#historyList li { padding:6px 4px; border-radius:4px; margin-bottom:3px; background:#eee; cursor:pointer; }
#historyList li:hover { background:#FD5A1E; color:#fff; }
#main { flex:1; display:flex; flex-direction:column; padding:10px; }
#chat { flex:1; overflow-y:auto; border:1px solid #ccc; padding:10px; border-radius:8px; margin-bottom:10px; }
.message { margin:10px 0; padding:10px 15px; border-radius:18px; max-width:80%; word-wrap: break-word; }
.user { background:#FD5A1E; color:#fff; margin-left:auto; text-align:right; }
.assistant { background:#fff; color:#333; margin-right:auto; }
.dark .assistant { background:#222; color:#EEE; }
.meta { font-size:10px; color:#666; margin-top:4px; }
textarea, input, select { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:1px solid #ccc; }
button.action { background:#FD5A1E; color:#fff; border:none; border-radius:6px; padding:8px 12px; margin-top:5px; cursor:pointer;}
button.action:hover { background:#e04f1a; }
img.thumb { width:100px; height:auto; margin:5px; cursor:pointer; border:2px solid #FD5A1E; border-radius:6px; }
#modalOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:999; }
#modalOverlay img { max-width:90%; max-height:90%; border-radius:8px; }
</style>
</head>
<body>
<header>âš¾ Giants GPT Chat</header>
<div id="container">
  <div id="sidebar" class="">
    <h3>Chats</h3>
    <button onclick="newChat()">New Chat</button>
    <ul id="historyList"></ul>
  </div>
  <div id="main">
    <label>API Key:
      <input type="password" id="apiKey" placeholder="Enter your OpenAI key">
    </label>
    <button onclick="clearKey()">Clear API Key</button>

    <label>Model:
      <select id="modelSelect">
        <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
        <option value="gpt-4o-mini">gpt-4o-mini</option>
        <option value="gpt-4o">gpt-4o</option>
        <option value="gpt-5">gpt-5</option>
      </select>
    </label>

    <label><input type="checkbox" id="darkToggle"> Dark Mode</label>

    <label>Upload Document (TXT):
      <input type="file" id="fileInput" accept=".txt">
    </label>

    <div id="chat"></div>
    <div id="typing" style="display:none;">GPT is typing...</div>

    <textarea id="userInput" placeholder="Type your message..."></textarea>
    <div style="margin-top:10px;">
      <button class="action" onclick="sendMessage()">Send</button>
      <button class="action" onclick="generateImage()">Generate Image</button>
    </div>
  </div>
</div>

<div id="modalOverlay" onclick="this.style.display='none'"><img id="modalImg" src=""></div>

<script>
const apiKeyInput = document.getElementById("apiKey");
const modelSelect = document.getElementById("modelSelect");
const chatDiv = document.getElementById("chat");
const userInput = document.getElementById("userInput");
const typingDiv = document.getElementById("typing");
const darkToggle = document.getElementById("darkToggle");
const historyList = document.getElementById("historyList");
const modalOverlay = document.getElementById("modalOverlay");
const modalImg = document.getElementById("modalImg");
const fileInput = document.getElementById("fileInput");

const costPerThousandTokens = { 'gpt-3.5-turbo':0.0004, 'gpt-4o-mini':0.0015, 'gpt-4o':0.003, 'gpt-5':0.005 };
let chatHistory = JSON.parse(localStorage.getItem("chatHistory")||"[]");
let currentChat = [];
let currentChatName = "";

function saveSettings(){
  localStorage.setItem("apiKey", apiKeyInput.value);
  localStorage.setItem("model", modelSelect.value);
  localStorage.setItem("dark", darkToggle.checked?"true":"false");
}

function loadSettings(){
  apiKeyInput.value = localStorage.getItem("apiKey")||"";
  modelSelect.value = localStorage.getItem("model")||"gpt-4o-mini";
  if(localStorage.getItem("dark")==="true"){ darkToggle.checked=true; document.body.classList.add("dark"); }
  renderHistory();
}
loadSettings();

apiKeyInput.onchange = saveSettings;
modelSelect.onchange = saveSettings;
darkToggle.onchange = ()=>{
  document.body.classList.toggle("dark");
  saveSettings();
};

fileInput.addEventListener("change", (event)=>{
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    const text = e.target.result;
    userInput.value += "\n\n[File Content Start]\n" + text + "\n[File Content End]\n";
  };
  reader.readAsText(file);
});

function addMsg(role,text,meta="",isImage=false,imgUrl=""){
  const div = document.createElement("div");
  div.className = "message "+(role==="user"?"user":"assistant");
  if(isImage){
    const img = document.createElement("img");
    img.src = imgUrl; img.className="thumb";
    img.onclick = ()=>{ modalImg.src=imgUrl; modalOverlay.style.display="flex"; };
    div.appendChild(img);
  } else { div.innerHTML = text.replace(/\n/g,"<br>"); }
  if(meta){
    const span=document.createElement("div");
    span.className="meta"; span.textContent=meta;
    div.appendChild(span);
  }
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
  currentChat.push({role,text,meta,isImage,imgUrl});
  saveCurrentChat();
}

function saveCurrentChat(){ localStorage.setItem("currentChat",JSON.stringify(currentChat)); }
function saveChatToHistory(){
  if(currentChat.length===0) return;
  let firstMsg = currentChat.find(m=>m.role==="user")?.text||"Chat";
  currentChatName = firstMsg.length>20?firstMsg.slice(0,20)+"...":firstMsg;
  chatHistory.push({name: currentChatName,messages: currentChat});
  localStorage.setItem("chatHistory",JSON.stringify(chatHistory));
  renderHistory();
}

function renderHistory(){
  historyList.innerHTML="";
  chatHistory.forEach((chat,index)=>{
    const li = document.createElement("li");
    li.textContent = chat.name;
    li.onclick = ()=>{
      currentChat = chat.messages;
      currentChatName = chat.name;
      chatDiv.innerHTML="";
      currentChat.forEach(m=>addMsg(m.role,m.text,m.meta,m.isImage,m.imgUrl));
    };
    li.ondblclick = ()=>{
      const newName = prompt("Rename chat:",chat.name);
      if(newName) { chatHistory[index].name = newName; localStorage.setItem("chatHistory",JSON.stringify(chatHistory)); renderHistory(); }
    };
    historyList.appendChild(li);
  });
}

function newChat(){
  if(currentChat.length>0) saveChatToHistory();
  chatDiv.innerHTML=""; currentChat=[]; currentChatName="";
}

async function sendMessage(){
  const key = apiKeyInput.value.trim();
  const content = userInput.value.trim();
  const model = modelSelect.value;
  if(!key||!content) return;

  addMsg("user",content);
  userInput.value="";
  typingDiv.style.display="block";

  try{
    const res = await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+key },
      body: JSON.stringify({model,messages:[{role:"user",content}]})
    });
    const data = await res.json();
    typingDiv.style.display="none";
    if(data.error){ addMsg("assistant","Error: "+data.error.message); return; }
    const reply = data.choices[0].message.content;
    const tok = data.usage.total_tokens;
    const cost = (tok/1000*costPerThousandTokens[model]).toFixed(5);
    addMsg("assistant",reply,`Tokens: ${tok} | Cost: $${cost}`);
  } catch(err){ typingDiv.style.display="none"; addMsg("assistant","Error: "+err.message); }
}

async function generateImage() {
  const key = apiKeyInput.value.trim();
  const prompt = userInput.value.trim();
  if (!key || !prompt) return;

  addMsg("user", prompt);
  userInput.value = "";
  typingDiv.style.display = "block";

  try {
    const res = await fetch("https://api.openai.com/v1/images/generations", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${key}`,
      },
      body: JSON.stringify({
        prompt: prompt,
        n: 1,
        size: "512x512",
      }),
    });

    const data = await res.json();
    typingDiv.style.display = "none";

    if (data.error) {
      addMsg("assistant", `Error: ${data.error.message}`);
      return;
    }

    if (!data.data || !data.data[0] || !data.data[0].url) {
      addMsg("assistant", "Error: Unexpected response from OpenAI Images API.");
      console.error(data);
      return;
    }

    addMsg("assistant", "", "", true, data.data[0].url);
  } catch (err) {
    typingDiv.style.display = "none";
    addMsg("assistant", `Error: ${err.message}`);
  }
}

function clearKey(){ if(confirm("Remove saved API key?")){ localStorage.removeItem("apiKey"); apiKeyInput.value=""; } }
userInput.addEventListener("keydown", function(e){ if(e.key==="Enter"&&!e.shiftKey){ e.preventDefault(); sendMessage(); } });

renderHistory();
</script>
</body>
</html>
