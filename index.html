<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Giants GPT</title>

<!-- Giants favicon + Home Screen icon -->
<link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/en/3/30/San_Francisco_Giants_Logo.svg">
<link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/en/3/30/San_Francisco_Giants_Logo.svg">

<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #F5F5F5; color: #333; transition: background 0.3s, color 0.3s; }
.dark { background-color: #000; color: #FFF; }
h2 { color: #FD5A1E; text-align: center; }
#chat { max-height: 60vh; overflow-y: auto; margin-bottom: 15px; }
.message { margin: 10px 0; padding: 10px 15px; border-radius: 18px; max-width: 80%; line-height: 1.4; word-wrap: break-word; }
.user { background:#FD5A1E; color:#fff; margin-left:auto; text-align:right; }
.assistant { background:#ffffff; color:#333; margin-right:auto; }
.dark .assistant { background:#222; color:#EEE; }
.meta { font-size: 10px; color: #666; margin-top: 4px; }
textarea, input, select { width:100%; padding: 8px; margin-top: 5px; border-radius: 6px; border:1px solid #ccc; }
button { background-color:#FD5A1E; color:#fff; border:none; border-radius:6px; padding:8px 12px; margin-top:10px; cursor:pointer;}
button:hover { background-color:#e04f1a; }
#typing { color:#999; font-size: 12px; font-style: italic; }
img.generated { max-width: 100%; margin-top: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h2>âš¾ Giants GPT Chat</h2>

<label>API Key:
  <input type="password" id="apiKey" placeholder="Enter your OpenAI key">
</label>
<button onclick="clearKey()">Clear API Key</button>

<label>Model:
<select id="modelSelect">
  <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
  <option value="gpt-4o-mini">gpt-4o-mini</option>
  <option value="gpt-4o">gpt-4o</option>
  <option value="gpt-5">gpt-5</option>
</select>
</label>

<label>
  <input type="checkbox" id="darkToggle"> Dark Mode
</label>

<div id="chat"></div>
<div id="typing" style="display:none;">GPT is typing...</div>

<textarea id="userInput" placeholder="Type your message..."></textarea>
<div style="margin-top:10px;">
  <button onclick="sendMessage()">Send</button>
  <button onclick="generateImage()">Generate Image</button>
  <button onclick="clearChat()">Clear Chat</button>
</div>

<script>
const apiKeyInput = document.getElementById("apiKey");
const modelSelect = document.getElementById("modelSelect");
const chatDiv = document.getElementById("chat");
const userInput = document.getElementById("userInput");
const typingDiv = document.getElementById("typing");
const darkToggle = document.getElementById("darkToggle");
const costPerThousandTokens = { 'gpt-3.5-turbo':0.0004, 'gpt-4o-mini':0.0015, 'gpt-4o':0.003, 'gpt-5':0.005 };

function loadSaved(){
  apiKeyInput.value = localStorage.getItem("apiKey") || "";
  modelSelect.value = localStorage.getItem("model") || "gpt-4o-mini";
  if(localStorage.getItem("dark") === "true") { darkToggle.checked = true; document.body.classList.add("dark"); }
}
loadSaved();

apiKeyInput.onchange = ()=> localStorage.setItem("apiKey", apiKeyInput.value);
modelSelect.onchange = ()=> localStorage.setItem("model", modelSelect.value);
darkToggle.onchange = ()=>{
  if(darkToggle.checked){ document.body.classList.add("dark"); localStorage.setItem("dark","true"); }
  else{ document.body.classList.remove("dark"); localStorage.setItem("dark","false"); }
};

function addMsg(role,text,meta=""){
  const div = document.createElement("div");
  div.className = "message " + (role==="user"?"user":"assistant");
  div.innerHTML = text.replace(/\n/g,"<br>");
  if(meta){
    const span=document.createElement("div");
    span.className="meta"; span.textContent=meta;
    div.appendChild(span);
  }
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

async function sendMessage(){
  const key=apiKeyInput.value.trim();
  const content=userInput.value.trim();
  const model=modelSelect.value;
  if(!key||!content) return;

  addMsg("user",content);
  userInput.value="";
  typingDiv.style.display = "block";

  try{
    const res=await fetch("https://api.openai.com/v1/chat/completions",{
      method:"POST",
      headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+key },
      body: JSON.stringify({ model, messages:[{role:"user", content}]})
    });
    const data=await res.json();
    typingDiv.style.display = "none";

    if(data.error){
      addMsg("assistant","Error: "+data.error.message);
      return;
    }

    const reply=data.choices[0].message.content;
    const tok = data.usage.total_tokens;
    const cost = (tok/1000 * costPerThousandTokens[model]).toFixed(5);
    addMsg("assistant",reply,`Tokens: ${tok} | Cost: $${cost}`);
  }catch(err){
    typingDiv.style.display = "none";
    addMsg("assistant","Error: "+err.message);
  }
}

async function generateImage(){
  const key=apiKeyInput.value.trim();
  const prompt=userInput.value.trim();
  if(!key||!prompt) return;

  addMsg("user",prompt);
  userInput.value="";
  typingDiv.style.display = "block";

  try{
    const res=await fetch("https://api.openai.com/v1/images/generations",{
      method:"POST",
      headers:{ "Content-Type":"application/json", "Authorization":"Bearer "+key },
      body: JSON.stringify({ prompt, n:1, size:"512x512" })
    });
    const data=await res.json();
    typingDiv.style.display = "none";

    if(data.error){
      addMsg("assistant","Error: "+data.error.message);
      return;
    }
    if(!data.data || !data.data[0] || !data.data[0].url){
      addMsg("assistant","Error: Unexpected response from OpenAI Images API.");
      console.error(data);
      return;
    }

    const imgUrl = data.data[0].url;
    const div = document.createElement("div");
    div.className="message assistant";
    const img = document.createElement("img");
    img.src=imgUrl; img.className="generated";
    div.appendChild(img);
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;

  }catch(err){
    typingDiv.style.display = "none";
    addMsg("assistant","Error: "+err.message);
  }
}

function clearChat(){ chatDiv.innerHTML=""; }
function clearKey(){ if(confirm("Remove saved API key?")){ localStorage.removeItem("apiKey"); apiKeyInput.value=""; } }

// Send on Enter/Return
userInput.addEventListener("keydown", function(e){
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});
</script>

</body>
</html>
